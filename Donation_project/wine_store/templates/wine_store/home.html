{% extends "base.html" %}

{% block title %}
<title>&#127863; Buy me a wine</title>
{% endblock %}

{% block stylesheet %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/wine_store/home.css' %}">
{% endblock %}

{% block metaDescription %}
<meta name="description" content="{{ all_meta_description_objs.last.text }}">
{% endblock %}

{% block mainBox %}
<div id="HomePageBox">

    <div id="HomePageContentBox">

        <h1 id="MainHeader">Wine Store</h1>

        <div id="ApplicationBox">
            <img id="MyWineGif" src="{% static 'wine-time.gif' %}" alt="Wine time text on a wine image.">
            <p id="Hook">{{ all_hook_line_ojbs.last.text }} &#10084;&#65039;</p>
            <form id="MessageForm" action="." method="POST">
                {% csrf_token %}
                <label for="full_name" id="full_name_label">Full Name</label>
                <input type="text" id="full_name" name="full_name" required/>
                <label for="email" id="email_label">Email</label>
                <input type="text" id="email" name="email" required/>
                <label for="message" id="message_label">Message</label>
                <textarea id="message" name="message" required></textarea>
                <input type="submit" name="submitMsgBtn" class="donate" value="Donate 5CA$">
            </form>
        </div>

    </div>

</div>
{% endblock %}

<!-- Creating a javascript block for other html pages which will extend from this html file -->
{% block js %}
<script src="https://js.stripe.com/v3/"></script>

<script>
    const buy_now_button = document.querySelector('.donate');

    buy_now_button.addEventListener('click', event => {
    fetch('/checkout/')
    .then((result) => { return result.json() })
    .then((data) => {
        var stripe = Stripe(data.stripe_public_key);

        stripe.redirectToCheckout({
        // Make the id field from the Checkout Session creation API response
        // available to this file, so you can provide it as parameter here
        // instead of the {{CHECKOUT_SESSION_ID}} placeholder.
        sessionId: data.session_id
        }).then(function (result) {
        // If `redirectToCheckout` fails due to a browser or network
        // error, display the localized error message to your customer
        // using `result.error.message`.
        });
    })
    })

</script>
{% endblock %}